---
title: "Datenanalyse"
author: "Nadja Herrmann"
runtime: 
output:
 html_document:
  fig_height: 8
  fig_width: 12
  highlight: tango
  number_sections: yes
  theme: paper
  toc: yes
  toc_float: true
  toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Einleitung

In diesem Notebook werden die Daten, welche in dem Notebook __Datenintegration__ vorbereitet wurden, mit Hilfe von Visualisierungen analysiert. Dies ist der erste Teil des gewünschten Outputs des Projekts (siehe Abbildung 1).


<img src="files/Input_R_2.png" style="width:85%">

__Abbildung 1__: Konzeptionelles Vorgehen, Eigene Darstellung 2021

# Vorbereitung

## Notwendige Pakete laden

In diesem Notebook werden die folgenden Pakete verwendet:

```{r import packages, message=FALSE}
library(tidyverse)
library(ggplot2) #Visualisierung
library(plotly)
library(scales)
library(lubridate)
library(DT)
```

## Daten importieren

Der im Abschnitt __Datenintegration__ erstellte Datensatz _mobility_vaccine_ wird für dieses Notebook __Datenanalyse__ herangezogen.

```{r import_data}
mobility_vaccine <- read.csv("../Website/Daten_Output/Mobility_vaccine.csv")
```


## Beschreibung des finalen Datensatzes

```{r describe_data}
glimpse(mobility_vaccine)
```

Der ursprüngliche Datensatz besteht aus 17 Variablen. 
Einige der Variablen werden für das Dashboard (Output Teil 2) verwendet, sind aber für die folgende Analyse nicht relevant. Deshalb werden diese Variablen entfernt.

```{r delete_columns}
excluded_vars <- c("X", "country_region_code", "country_region", "iso_code", "ID", "Impfserie")

mobility_vaccine <- select(mobility_vaccine, -excluded_vars)
```

```{r describe_column_number}
no_cols<- ncol(mobility_vaccine)
```

```{r describe_row_number}
no_rows<- nrow(mobility_vaccine)
```

Der finale Datensatz __mobility_vaccine__ besteht aus `r no_cols` Spalten und `r no_rows` Zeilen. In der folgenden Tabelle werden die Variablen und ihre Merkmale beschrieben.


| Variable            | Beschreibung    | Datentyp    |
| ------------------- |:---------------:|:---------------:|
|date                 |Datum            |Character|
|bundesland           |Bundesland       |Character|
|ID                   |Bundesland_ID    |Integer|
|Impfstoff            |Impfstoff verwendet|Character|
|Impfserie            |Serie Impfstoff verwendet|Integer|
|Anzahl               |Anzahl Impfungen pro Tag|Integer|
|Einwohner_2020       |Einwohnerzahl pro Bundesland|Integer|
|retail_and_recreation|Einzelhandel und Erholung|Integer|
|grocery_and_pharmacy|Lebensmittel und Apotheken|Integer|
|parks | Park (z.B.: Öffentlicher Park, Schloss, Waldgebiete|Integer|
|transit_stations |Transitstationen|Integer|
|workplaces |Arbeitsstätten|Integer|
|residential |Haus und Wohnungen|Integer|


Die Funktion __ymd__ wandelt in Zeichen- und numerischen Vektoren gespeicherte Daten in Date- oder POSIXct-Objekte um. Aus dem Character __date__ wird ein Dateobjekt gemacht.

```{r}
mobility_vaccine$date <- ymd(mobility_vaccine$date)
```

Des weiteren wird die Spalte __date__ dupliziert, damit drei neue Spalten __Year__, __Month__ und __Date__ erstellt werden können. Diese Anpassung erfolgt zur Vereinfachung der Aggregierung der Daten. Im nächsten Schritt eine zusätzliche Spalte mit der Bezeichnung __year_month__ erstellt. Somit können Visualisierungen für den gesamten Zeitraum auf monatsebene erstellt werden.

```{r}
mobility_vaccine <- mobility_vaccine %>% 
                mutate(date_2 = date)%>% 
   separate(date_2, c("Year", "Month", "Day"), sep="-")%>% 
            unite(year_month, c(Year, Month), sep = "/", remove = FALSE)
```

Da der Impfstoff __Janssen__ nach einer einmaligen Impfung den vollen Impfstoff bietet, werden die weiteren Impfstoffe (mind. 2 Impfungen Stand heute) durch 2 geteilt. Somit kann der __Impffortschritt__ besser verglichen werden.

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_fortschritt = case_when(Impfstoff == "Comirnaty" ~ Anzahl/2,
                                      Impfstoff == "AstraZeneca" ~ Anzahl/2,
                                      Impfstoff == "Moderna" ~ Anzahl/2,
                                      Impfstoff == "Janssen" ~ Anzahl*1))
```

Um das Verhältnis der Impfungen in Relation zu den Einwohnerzahlen zur bringen wird als nächstes die Impfquote berechnet. 
Hierzu wird der __Impffortschritt__ also die Anzahl der Impfungen in das Verhältnis zu der Einwohnerzahl gesetzt und _*100_ multipliziert.

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_quote = (impf_fortschritt/Einwohner_2020)*100)
```

Das R-Paket __DT__ bietet eine R-Schnittstelle zur JavaScript-Bibliothek DataTables. R-Datenobjekte (Matrizen oder Datenrahmen) können als Tabellen auf HTML-Seiten angezeigt werden, und DataTables bietet Filterung, Paginierung, Sortierung und viele andere Funktionen in den Tabellen.

Der für die Analyse herangezogene Datensatz sieht nun wie folgt aus:

```{r}
mobility_vaccine_head <- mobility_vaccine%>% slice(1:50)

datatable(mobility_vaccine_head, filter = 'top', options = list(
  pageLength = 5, autoWidth = TRUE
)) %>% 
  formatDate('date', 'toDateString') %>% 
  formatCurrency(c('retail_and_recreation','grocery_and_pharmacy', 'parks', 'transit_stations', 'workplaces','residential'), '%') %>% 
  formatPercentage('impf_quote',2)
  
```


# Analyse des finalen Datensatzes

## Betrachtungszeitraum

Der Betrachtungszeitraum liegt zwischen dem 27.12.2020 bis zum 15.10.2021.

```{r}
mobility_vaccine %>% 
    select(date) %>% 
    summarise(max = max(date, na.rm = TRUE), min = min(date, na.rm = TRUE))
```


## Deutschland Impfung gesamt

```{r}
summe_impfungen_gesamt <-mobility_vaccine %>%
              summarise(
              sum_impfungen = sum(Anzahl))
```

In dem Zeitraum vom 27.12.2020 bis 15.10.2021 wurden in Deutschland  `r summe_impfungen_gesamt` Impfungen verabreicht.


## Deutschland Impfung pro Jahr

In 2020 wurden in Summe 207.060 Impfungen verabreicht, während in 2021 bis zum 15.10.2021 in Summe 109.314.592 Impfungen verabreicht wurden (inkl. Zweitimpfung).



```{r, echo = TRUE,fig.width = 5,fig.height = 4, warning=FALSE}
graph_0 <- mobility_vaccine %>%
  group_by(Year) %>% 
  summarise(summe_pro_jahr = sum(Anzahl)) %>% 
  ggplot(aes(x = Year, y = summe_pro_jahr))+
  geom_col(colour="darkslategray", fill = "darkslategray4")+
  theme_classic()+
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE)) +
  labs(
    y = element_blank(),
    x = element_blank()
  )

ggplotly(graph_0) %>%
  layout(title = list(text = paste0("Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Impfungen gesamt nach Jahr",'</sup>')))
```

## Welcher Impfstoff wurde am häufigsten verabreicht?

Der Impfstoff __Biontech/Comirnaty__ wurde in Summe am häufigsten verabreicht (84.047.591). Von dem Impfstoff __AstraZeneca__ wurden 12.670.077 Dosen geimpft, __Moderna__ folgt mit 9.553.672 Impfungen und __Janssen__ mit 3.250.312 Dosen.



```{r, echo = TRUE,fig.width = 5,fig.height = 4, warning=FALSE}
graph_1 <- mobility_vaccine %>%
  group_by(Impfstoff) %>% 
  summarise(summe_impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = Impfstoff, y=summe_impfungen))+
  geom_col(colour="darkslategray", fill = "darkslategray4")+
  theme_classic()+
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE)) +
  labs(
    y = element_blank(),
    x = element_blank()
  )

ggplotly(graph_1) %>%
  layout(title = list(text = paste0("Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Anzahl Impfungen nach Impfstoff",'</sup>')))
```



```{r, echo = TRUE,fig.width = 5,fig.height = 4, warning=FALSE}
graph_2 <-mobility_vaccine %>%
  group_by(Year, Impfstoff) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = Year, y = Impfungen, group = Impfstoff, colour = Impfstoff, fill = Impfstoff))+
  geom_col(size=1.2)+ 
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE))+
  theme_minimal()+
  labs(
    y = element_blank(),
    x = element_blank()
  )

ggplotly(graph_2) %>%
  layout(title = list(text = paste0("Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Anzahl Impfungen nach Impfstoff pro Jahr",'</sup>')))
```

## Impfungen zeitlicher Verlauf (pro Monat & Jahr)

Mit Hilfe der folgenden Funktion wird die Anzahl der Impfungen pro Monat aufgezeigt. 


```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_3 <-mobility_vaccine %>%
  group_by(year_month) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = year_month, y = Impfungen))+
  geom_col(size=1.2, colour="darkslategray", fill = "darkslategray4")+ 
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = element_blank(),
    x = element_blank()
  )


ggplotly(graph_3) %>%
  layout(title = list(text = paste0("Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Anzahl Impfungen pro Monat",'</sup>')))

```

## Deutschland Impfung pro Bundesland



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_4 <-mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(sum_impfungen = sum(Anzahl), 
    min_anzahl = min(Anzahl),
    mean_anzahl = mean(Anzahl)) %>% 
  ggplot(aes(x = reorder(Bundesland, -sum_impfungen), y = sum_impfungen))+
  geom_col(size=1.2, colour="darkslategray", fill = "darkslategray4")+ 
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = element_blank(),
    x = element_blank()
  )

ggplotly(graph_4) %>%
  layout(title = list(text = paste0("Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Anzahl Impfungen pro Bundesland",'</sup>')))
```


## Einwohner pro Bundesland



```{r}
einwohner <- mobility_vaccine %>%
  distinct(Bundesland, Einwohner_2020) 

datatable(einwohner, filter = 'top')
```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
 graph_5<-mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(Einwohner = min(Einwohner_2020)) %>% 
  ggplot(aes(x = reorder(Bundesland, -Einwohner), y = Einwohner))+
  geom_col(size=1.2, colour="darkslategray", fill = "darkslategray4")+ 
  scale_y_continuous(labels = function(x) format(x, big.mark = ".",
                                                scientific = FALSE))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = element_blank(),
    x = element_blank()
  )

ggplotly(graph_5) %>%
  layout(title = list(text = paste0("Einwohner pro Bundesland",
                                    '<br>',
                                    '<sup>',
                                     "absteigend sortiert",'</sup>')))
```


## Impfquote



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_6 <- mobility_vaccine %>%
  group_by(Bundesland) %>% 
  summarise(quote = sum(impf_quote)) %>%  
  ggplot()+
  geom_point(aes(x = reorder(Bundesland, -quote), y = quote), size=2, colour="darkslategray")+
  geom_col(aes(x = reorder(Bundesland, -quote), y = quote), colour="darkslategray4", fill="darkslategray4")+
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Impfquote [%]",
    x = element_blank()
  )+ylim(0,100)

ggplotly(graph_6) %>%
  layout(title = list(text = paste0("Impfquote pro Bundesland",
                                    '<br>',
                                    '<sup>',
                                     "absteigend sortiert",'</sup>')))

```



## Impfverlauf



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_7 <-mobility_vaccine %>%
  group_by(year_month, Impfstoff) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = year_month, y = Impfungen, group = Impfstoff, colour = Impfstoff, fill = Impfstoff))+
  geom_col()+ 
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Anzahl",
    x = element_blank()
  )


ggplotly(graph_7) %>%
  layout(title = list(text = paste0("Anzahl Covid Impfungen",
                                    '<br>',
                                    '<sup>',
                                     "Pro Monat & Bundesland",'</sup>')))
```



## Retail and recreation gesamt



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_8 <- ggplot(mobility_vaccine, aes(x = date, y = retail_and_recreation)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_8) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Einzelhandel und Erholung",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_9 <- ggplot(mobility_vaccine, aes(x = date, y = retail_and_recreation, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_9) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Einzelhandel und Erholung",'</sup>')))
```


## grocery and pharmacy



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_10 <- ggplot(mobility_vaccine, aes(x = date, y = grocery_and_pharmacy)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_10) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Apotheken und Läden des täglichen Bedarfs",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_11 <- ggplot(mobility_vaccine, aes(x = date, y = grocery_and_pharmacy, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_11) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Apotheken und Läden des täglichen Bedarfs",'</sup>')))
```


## parks



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_12 <- ggplot(mobility_vaccine, aes(x = date, y = parks)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_12) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie öffentlichen Parks, Schlössern, Waldgebieten etc.",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_13 <- ggplot(mobility_vaccine, aes(x = date, y = parks, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_13) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Apotheken und Läden des täglichen Bedarfs",'</sup>')))
```



## transit_stations



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_14 <- ggplot(mobility_vaccine, aes(x = date, y = transit_stations)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_14) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Transitstationen",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_15 <- ggplot(mobility_vaccine, aes(x = date, y = transit_stations, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_15) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Transitstationen",'</sup>')))
```


## workplaces



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_16 <- ggplot(mobility_vaccine, aes(x = date, y = workplaces)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_16) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "Am Arbeitsplatz",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_17 <- ggplot(mobility_vaccine, aes(x = date, y = workplaces, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_17) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "Am Arbeitsplatz",'</sup>')))
```


## residential



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_18 <- ggplot(mobility_vaccine, aes(x = date, y = residential)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_18) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "An Orten wie Wohngebieten",'</sup>')))

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
graph_19 <- ggplot(mobility_vaccine, aes(x = date, y = residential, fill = Bundesland, color = Bundesland)) +
  geom_point()+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("1 month"))+
  theme_classic()+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    y = "Abweichung zum Referenzwert [%]",
    x = element_blank()
  )

ggplotly(graph_19) %>%
  layout(title = list(text = paste0("Mobilitätsaufkommen",
                                    '<br>',
                                    '<sup>',
                                     "In Wohngebieten",'</sup>')))
```


## Mobilitätsaufkommen vs. Impfungen


```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(retail_and_recreation),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(grocery_and_pharmacy),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(parks),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(transit_stations),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(workplaces),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```



```{r, echo = TRUE,fig.width = 8,fig.height = 6, warning=FALSE}
mobility_vaccine %>%
  group_by(date) %>% 
  summarise(max = mean(residential),
            sum = sum(Anzahl)) %>% 
  summarise(max = max,
            sum = cumsum(sum),
            date = date) %>% 
  ggplot()+
  geom_line(aes(x = date, y = max), size = 0.8, color = "darkslategray")+
  geom_line(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_point(aes(x = date, y = sum/1000000), size = 0.8, color = "darkslateblue")+
  geom_hline(yintercept=0, linetype="dashed", color = "grey")+
  scale_y_continuous(sec.axis = sec_axis(~.*1,name = "Anzahl Impfungen kumuliert [Mio]"))+
  scale_x_date(labels = date_format("%b %y"),
               date_breaks = ("2 weeks"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  labs(
    title = "Mobilitätsaufkommen vs Impfverlauf",
    subtitle = "An Orten wie Einzelhandel und Erholung",
    y = "Abweichung zum Rezerenzwert [%]"
  )

```
