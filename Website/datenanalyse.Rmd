---
title: "Datenanalyse"
author: "Nadja Herrmann"
runtime: shiny
output:
 html_document:
  fig_height: 8
  fig_width: 12
  highlight: tango
  number_sections: yes
  theme: paper
  toc: yes
  toc_float: true
  toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Konzeptionelles Vorgehen {.sidebar}


<img src="files/Input_R_2.png" style="width:85%">

__Abbildung 1__: Konzeptionelles Vorgehen, Eigene Darstellung 2021

# Notwendige Pakete laden

Die folgenden Pakete werden für dieses Notebook benötigt:

```{r import packages, message=FALSE}
library(tidyverse)
library(ggplot2) #Visualisierung
library(plotly)
library(shiny)
```

# Daten importieren

```{r import_data}

mobility_vaccine <- read.csv("../Website/Daten_Output/Mobility_vaccine.csv")
```

# Daten beschreiben

```{r}
glimpse(mobility_vaccine)
```

```{r}
mobility_vaccine <- mobility_vaccine[,-1]
```

```{r}
no_cols<- ncol(mobility_vaccine)
```

```{r}
no_rows<- nrow(mobility_vaccine)
```

```{r, results=FALSE}
is.na(mobility_vaccine)
```

Der finale Datensatz __mobility_vaccine__ besteht aus `r no_cols` Spalten und `r no_rows` Zeilen.

```{r}
mobility_vaccine <- mobility_vaccine %>% 
                mutate(date_2 = date)
```

```{r}
mobility_vaccine <- mobility_vaccine %>% 
   separate(date_2, c("Year", "Month", "Day"), sep="-")
```

```{r}
mobility_vaccine <- mobility_vaccine %>% 
            unite(year_month, c(Year, Month), sep = "/", remove = FALSE)
```

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_fortschritt = case_when(Impfstoff == "Comirnaty" ~ Anzahl/2,
                                      Impfstoff == "AstraZeneca" ~ Anzahl/2,
                                      Impfstoff == "Moderna" ~ Anzahl/2,
                                      Impfstoff == "Janssen" ~ Anzahl*1))
```


## Betrachtungszeitraum

```{r}
mobility_vaccine %>% 
    select(date) %>% 
    summarise(max = max(date, na.rm = TRUE), min = min(date, na.rm = TRUE))
```

Der Zeitraum der Betrachtung der Daten ist ab dem 27.12.2020 bis zum 15.10.2021. Da in diesem Projekt das Mobilitätsaufkommen in Verbindung mit den Impffortschritten gebracht wird ist der Entfall der Mobilitätsdaten für den früheren Zeitraum in Ordnung.


## Deutschland Impfung gesamt


```{r}
summe_impfungen_gesamt <-mobility_vaccine %>%
              summarise(
              sum_impfungen = sum(Anzahl))
summe_impfungen_gesamt
```

In Summe wurden in Deutschland in dem Zeitraum vom 27.12.2020 bis 15.10.2021 `r summe_impfungen_gesamt` verabreicht.


## Deutschland Impfung pro Jahr

```{r}
mobility_vaccine %>%
  group_by(Year) %>% 
  summarise(summe_pro_jahr = sum(Anzahl))
```

## Welcher Impfstoff wurde am häufigsten verabreicht?

```{r}
mobility_vaccine %>%
  group_by(Impfstoff) %>% 
  summarise(summe = sum(Anzahl)) %>% 
  arrange(desc(summe))
```

## Impfungen zeitlicher Verlauf (pro Monat & Jahr)

```{r}
mobility_vaccine %>%
  group_by(Month, Year) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  arrange(desc(Month))
```

## Deutschland Impfung pro Bundesland

```{r}
mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(
    sum_impfungen = sum(Anzahl), 
    min_anzahl = min(Anzahl),
    mean_anzahl = mean(Anzahl)
  ) %>% 
  arrange(desc(sum_impfungen))
```

Das Bundesland mit den am meisten verabreichten Impfungen ist __Nordrhein-Westfalen__, auf dem zweiten Platz __Bayern__ und im Anschluss darauf Baden-Württemberg.

## Einwohner pro Bundesland

```{r}
mobility_vaccine %>%
  distinct(Bundesland, Einwohner_2020) %>% 
  arrange(desc(Einwohner_2020))
```


## Impfquote

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_quote = (impf_fortschritt/Einwohner_2020))
```


```{r}
mobility_vaccine %>%
  group_by(Bundesland) %>% 
  summarise(quote = sum(impf_quote)*100) %>% 
  arrange(desc(quote))
```


```{r Verteilung_impfstoffe_2021}
ggplot(mobility_vaccine, aes(x = Year, y = Anzahl)) + 
  geom_col() +
  labs(
    x = "- -",
    y = "-",
    title = "-")+
    facet_wrap(Impfstoff ~.)
```

```{r impfung_pro_jahr}
a<-mobility_vaccine %>% 
  group_by(Impfstoff) %>% 
  ggplot(aes(Year, Anzahl, colour = Impfstoff)) +
            geom_line()+
            theme(axis.text.x = element_text(angle = -90, vjust = 0.5, hjust=1))+
            labs(color= "Impfstoff", title= "Anzahl Impfungen", subtitle = "Pro Impfstoff über den zeitlichen Verlauf",
       x = "Datum", y = "Anzahl")

ggplotly(a)
```


```{r impfung_pro_monat}
p<-mobility_vaccine %>% 
  group_by(Impfstoff) %>% 
  ggplot(aes(year_month, Anzahl, colour = Impfstoff)) +
            geom_line()+
            theme(axis.text.x = element_text(angle = -90, vjust = 0.5, hjust=1))+
            labs(color= "Impfstoff", title= "Anzahl Impfungen", subtitle = "Pro Impfstoff über den zeitlichen Verlauf",
       x = "Datum", y = "Anzahl")

ggplotly(p)
```

## Mobilitätsaufkommen

```{r}
mobility_vaccine %>%
  group_by(year_month) %>% 
  summarise(mean = mean(retail_and_recreation),
            max = max(retail_and_recreation),
            min = min(retail_and_recreation))
```


## Retail and recreation gesamt

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = retail_and_recreation)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = retail_and_recreation, fill = Bundesland, color = Bundesland)) +
  geom_point()
```


## grocery and pharmacy gesamt

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = grocery_and_pharmacy)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = grocery_and_pharmacy, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## parks

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = parks)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = parks, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## transit_stations

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = transit_stations)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = transit_stations, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## workplaces

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = workplaces)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = workplaces, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## residential

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = residential)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = residential, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## Kombination


```{r}
#c <- ggplot()+
 # geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=impf_fortschritt), color = "blue")+
 # geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=impf_fortschritt), color = "blue")+
  #geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=mean_ret), color = "red")+
 #geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=mean_ret), color = "red") +
 # scale_y_continuous(labels = comma_format(big.mark = ".",
    #                                       decimal.mark = ","),
        #             limits = c(-60, 14000000))



#ggplotly(c)
```
