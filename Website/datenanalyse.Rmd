---
title: "Datenanalyse"
author: "Nadja Herrmann"
runtime: 
output:
 html_document:
  fig_height: 8
  fig_width: 12
  highlight: tango
  number_sections: yes
  theme: paper
  toc: yes
  toc_float: true
  toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Konzeptionelles Vorgehen {.sidebar}


<img src="files/Input_R_2.png" style="width:85%">

__Abbildung 1__: Konzeptionelles Vorgehen, Eigene Darstellung 2021

# Notwendige Pakete laden

Die folgenden Pakete werden für dieses Notebook benötigt:

```{r import packages, message=FALSE}
library(tidyverse)
library(ggplot2) #Visualisierung
library(plotly)
library(scales)
```

# Daten importieren

```{r import_data}

mobility_vaccine <- read.csv("../Website/Daten_Output/Mobility_vaccine.csv")
```

# Daten beschreiben

```{r describe_data}
glimpse(mobility_vaccine)
```

```{r delete_column_1}
mobility_vaccine <- mobility_vaccine[,-1]
```

```{r describe_column_number}
no_cols<- ncol(mobility_vaccine)
```

```{r describe_row_number}
no_rows<- nrow(mobility_vaccine)
```

Der finale Datensatz __mobility_vaccine__ besteht aus `r no_cols` Spalten und `r no_rows` Zeilen. Im nächsten Schritt wird geprüft ob der Datensatz fehlende Elemente besitzt.

```{r, results=FALSE}
is.na(mobility_vaccine)
```

Die Spalte ___date__ wird dupliziert, dass im weiteren Vorgehen drei neue Spalten __Year__, __Month__ und __Date__ erstellt werden können.

```{r}
mobility_vaccine <- mobility_vaccine %>% 
                mutate(date_2 = date)
```

An der Stelle __-__ wird die Spalte __date_2__ gesplittet.

```{r}
mobility_vaccine <- mobility_vaccine %>% 
   separate(date_2, c("Year", "Month", "Day"), sep="-")
```

Zur weiteren Analyse wird im nächsten Schritt eine zusätzliche Spalte mit der Bezeichnung __year_month__ erstellt. Somit können Visualisierungen für den gesamten Zeitraum auf monatsebene erstellt werden.

```{r}
mobility_vaccine <- mobility_vaccine %>% 
            unite(year_month, c(Year, Month), sep = "/", remove = FALSE)
```

Da der Impfstoff __Janssen__ nach einer einmaligen Impfung den vollen Impfstoff bietet, werden die weiteren Impfstoffe (mind. 2 Impfungen Stand heute) durch 2 geteilt. Somit kann der Impffortschritt besser beschrieben werden.

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_fortschritt = case_when(Impfstoff == "Comirnaty" ~ Anzahl/2,
                                      Impfstoff == "AstraZeneca" ~ Anzahl/2,
                                      Impfstoff == "Moderna" ~ Anzahl/2,
                                      Impfstoff == "Janssen" ~ Anzahl*1))
```


## Betrachtungszeitraum

Der Zeitraum der Betrachtung der Daten ist ab dem 27.12.2020 bis zum 15.10.2021. Da in diesem Projekt das Mobilitätsaufkommen in Verbindung mit den Impffortschritten gebracht wird ist der Entfall der Mobilitätsdaten für den früheren Zeitraum in Ordnung.

```{r}
mobility_vaccine %>% 
    select(date) %>% 
    summarise(max = max(date, na.rm = TRUE), min = min(date, na.rm = TRUE))
```


## Deutschland Impfung gesamt


```{r}
summe_impfungen_gesamt <-mobility_vaccine %>%
              summarise(
              sum_impfungen = sum(Anzahl))
summe_impfungen_gesamt
```

In Summe wurden in Deutschland in dem Zeitraum vom 27.12.2020 bis 15.10.2021 `r summe_impfungen_gesamt` verabreicht.


## Deutschland Impfung pro Jahr

In 2020 wurden in Summe 207060 Impfungen verabreicht während in 2021 bis zum 15.10.2021 in Summe 109.314.592 Impfungen verabreicht wurden (inkl. Zweitimpfung).

```{r}
mobility_vaccine %>%
  group_by(Year) %>% 
  summarise(summe_pro_jahr = sum(Anzahl))%>% 
  ggplot(aes(x = Year, y = summe_pro_jahr))+
  geom_col()
```

## Welcher Impfstoff wurde am häufigsten verabreicht?

Der Impfstoff __Biontech/Comirnaty__ wurde in Summe am häufigsten verabreicht (84.047.591). Von dem Impfstoff __AstraZeneca__ wurden 12.670.077 Dosen geimpft, __Moderna__ folgt mit 9.553.672 Impfungen und __Janssen__ mit 3.250.312 Dosen.

```{r}
mobility_vaccine %>%
  group_by(Impfstoff) %>% 
  summarise(summe_impfungen = sum(Anzahl)) %>% 
  arrange(desc(summe_impfungen))
```


```{r}
k <-mobility_vaccine %>%
  group_by(Year, Impfstoff) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = Year, y = Impfungen, group = Impfstoff, colour = Impfstoff))+
  geom_col()+ 
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplotly(k)
```

## Impfungen zeitlicher Verlauf (pro Monat & Jahr)

Mit Hilfe der folgenden Funktion wird die Anzahl der Impfungen pro Monat aufgezeigt. 


```{r}
g <-mobility_vaccine %>%
  group_by(year_month) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = year_month, y = Impfungen))+
  geom_col()+
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()

ggplotly(g)
```

## Deutschland Impfung pro Bundesland

```{r}
mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(
    sum_impfungen = sum(Anzahl), 
    min_anzahl = min(Anzahl),
    mean_anzahl = mean(Anzahl)
  ) %>% 
  arrange(desc(sum_impfungen))
```


```{r}
h <-mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(sum_impfungen = sum(Anzahl), 
    min_anzahl = min(Anzahl),
    mean_anzahl = mean(Anzahl)) %>% 
  ggplot(aes(x = reorder(Bundesland, -sum_impfungen), y = sum_impfungen))+
  geom_col()+
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplotly(h)
```

Das Bundesland mit den am meisten verabreichten Impfungen ist __Nordrhein-Westfalen__, auf dem zweiten Platz __Bayern__ und im Anschluss darauf Baden-Württemberg.

## Einwohner pro Bundesland

```{r}
mobility_vaccine %>%
  distinct(Bundesland, Einwohner_2020) %>% 
  arrange(desc(Einwohner_2020))
```

```{r}
 i<-mobility_vaccine %>%
  group_by(Bundesland) %>%
  summarise(Einwohner = min(Einwohner_2020)) %>% 
  ggplot(aes(x = reorder(Bundesland, -Einwohner), y = Einwohner))+
  geom_col()+
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplotly(i)
```


## Impfquote

```{r}
mobility_vaccine <-mobility_vaccine  %>%
  mutate(impf_quote = (impf_fortschritt/Einwohner_2020)*100)
mobility_vaccine
```


```{r}
j <- mobility_vaccine %>%
  group_by(Bundesland) %>% 
  summarise(quote = sum(impf_quote)) %>%  
  ggplot(aes(x = reorder(Bundesland, -quote), y = quote))+
  geom_col()+
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))+
  ylim(0,100)

ggplotly(j)
```



```{r}
p <-mobility_vaccine %>%
  group_by(year_month, Impfstoff) %>%
  summarise(Impfungen = sum(Anzahl)) %>% 
  ggplot(aes(x = year_month, y = Impfungen, group = Impfstoff, colour = Impfstoff))+
  geom_col()+ 
  scale_y_continuous(labels = comma_format(big.mark = ".",
                                          decimal.mark = ","))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

ggplotly(p)
```


## Mobilitätsaufkommen

```{r}
mobility_vaccine %>%
  group_by(year_month) %>% 
  summarise(mean = mean(retail_and_recreation),
            max = max(retail_and_recreation),
            min = min(retail_and_recreation))
```


## Retail and recreation gesamt

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = retail_and_recreation)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = retail_and_recreation, fill = Bundesland, color = Bundesland)) +
  geom_point()
```


## grocery and pharmacy gesamt

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = grocery_and_pharmacy)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = grocery_and_pharmacy, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## parks

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = parks)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = parks, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## transit_stations

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = transit_stations)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = transit_stations, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## workplaces

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = workplaces)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = workplaces, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## residential

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = residential)) +
  geom_point()
```

```{r}
ggplot(mobility_vaccine, aes(x = year_month, y = residential, fill = Bundesland, color = Bundesland)) +
  geom_point()
```

## Kombination



```{r}
c <- ggplot()+
  geom_col(data = data_1, mapping = aes(x=year_month, y=Impfungen), color = "blue")+
  geom_col(data = data_1, mapping = aes(x=year_month, y=Impfungen), color = "blue")+
 scale_y_continuous(labels = comma_format(big.mark = ".",
                                      decimal.mark = ","),
                                limits = c(-60, 14000))


+
  #geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=mean_ret), color = "red")+
 #geom_point(data = mobility_vaccine, mapping = aes(x=year_month, y=mean_ret), color = "red") +
 # scale_y_continuous(labels = comma_format(big.mark = ".",
    #                                       decimal.mark = ","),
        #             limits = c(-60, 14000000))



ggplotly(c)
```

```{r}
ggplotly(c)
```

